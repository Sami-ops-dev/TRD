<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Position Size Calculator</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f8fafc; /* Very light, clean background */
            display: flex;
            justify-content: center;
            align-items: center; /* Center vertically for a single app */
            min-height: 100vh;
            padding: 20px; /* Adjusted padding for mobile */
        }
        .container {
            background-color: #ffffff;
            padding: 2rem; /* Adjusted padding */
            border-radius: 1.5rem; /* Slightly less rounded for a tighter feel */
            box-shadow: 0 15px 30px rgba(0, 0, 0, 0.15); /* Softer shadow */
            width: 100%;
            max-width: 500px; /* Max width for mobile-first design */
            border: 1px solid #cbd5e0; /* Lighter subtle border */
        }
        h1 {
            font-size: 2.5rem; /* Adjusted title size for mobile */
            font-weight: 900;
            margin-bottom: 1.5rem; /* Adjusted space */
            text-align: center;
            letter-spacing: -0.02em;
            background: linear-gradient(45deg, #7f58af, #4299e1);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            color: transparent;
            text-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        }
        label {
            display: block;
            margin-bottom: 0.5rem;
            color: #4a5568;
            font-weight: 600;
            font-size: 0.95rem;
        }
        input[type="number"], select {
            width: 100%;
            padding: 0.85rem; /* Smaller padding for inputs */
            margin-bottom: 1.25rem; /* Adjusted space below inputs */
            border: 1px solid #cbd5e0;
            border-radius: 0.75rem; /* Adjusted rounded */
            box-shadow: inset 0 1px 3px rgba(0, 0, 0, 0.05);
            transition: all 0.2s ease-out;
            font-size: 1rem;
        }
        input[type="number"]:focus, select:focus {
            border-color: #7f58af;
            box-shadow: 0 0 0 4px rgba(127, 88, 175, 0.2); /* Smaller, softer focus ring */
            outline: none;
        }
        button {
            width: 100%;
            padding: 1rem 1.5rem; /* Adjusted padding for buttons */
            color: white;
            font-weight: 700;
            border-radius: 1rem; /* Adjusted rounded */
            border: none;
            cursor: pointer;
            transition: all 0.2s ease-out;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1); /* Softer shadow */
            letter-spacing: 0.02em;
        }
        button:hover {
            transform: translateY(-3px); /* Less noticeable lift */
            box-shadow: 0 8px 20px rgba(0, 0, 0, 0.15);
        }
        button:active {
            transform: translateY(0);
            box-shadow: 0 3px 10px rgba(0, 0, 0, 0.08);
        }
        .btn-primary {
            background-color: #7f58af;
        }
        .btn-primary:hover {
            background-color: #6c4e95;
        }
        .result-box {
            background-color: #e0f2fe;
            padding: 1.25rem; /* Adjusted padding */
            border-radius: 0.85rem; /* Adjusted rounded */
            margin-top: 1.5rem; /* Adjusted margin */
            border: 1px solid #90cdf4;
            color: #2c5282;
            font-weight: 600;
            text-align: center;
            box-shadow: inset 0 1px 3px rgba(0, 0, 0, 0.05);
            display: none;
            font-size: 1.05rem; /* Slightly larger result text */
        }
        .result-box.show {
            display: block;
        }
        .result-box p {
            margin-bottom: 0.5rem;
        }
        .result-box p:last-child {
            margin-bottom: 0;
        }
        .error-message {
            color: #c53030;
            background-color: #fed7d7;
            padding: 0.8rem; /* Adjusted padding */
            border-radius: 0.6rem; /* Adjusted rounded */
            margin-bottom: 1rem; /* Adjusted space */
            text-align: center;
            font-weight: 600;
            display: none;
            font-size: 0.9rem;
        }
        .error-message.show {
            display: block;
        }
    </style>
</head>
<body>
    <div class="container">
        <header class="text-center mb-6">
            <h1>Position Size Calculator</h1>
            <p class="text-gray-600 text-base">Calculate your ideal lot size based on your risk.</p>
        </header>

        <div>
            <div id="calcErrorMessage" class="error-message"></div>
            <div class="space-y-4">
                <div>
                    <label for="capital">Account Capital (€) :</label>
                    <input type="number" id="capital" value="1000" min="1" step="any">
                </div>
                <div>
                    <label for="riskPercentage">Risk Percentage per Trade (%) :</label>
                    <input type="number" id="riskPercentage" value="1" min="0.1" max="10" step="0.1">
                </div>
                <div>
                    <label for="currencyPair">Currency Pair / Asset :</label>
                    <select id="currencyPair">
                        <option value="EURUSD">EUR/USD</option>
                        <option value="GBPUSD">GBP/USD</option>
                        <option value="USDJPY">USD/JPY</option>
                        <option value="AUDUSD">AUD/USD</option>
                        <option value="USDCAD">USD/CAD</option>
                        <option value="USDCHF">USD/CHF</option>
                        <option value="NZDUSD">NZD/USD</option>
                        <option value="EURJPY">EUR/JPY</option>
                        <option value="GBPJPY">GBP/JPY</option>
                        <option value="XAUUSD">Gold (XAU/USD)</option>
                        <option value="DAX40">DAX 40 (Germany)</option>
                        <option value="SP500">S&P 500 (USA)</option>
                        <option value="NASDAQ100">NASDAQ 100 (USA)</option>
                        <option value="CAC40">CAC 40 (France)</option>
                        <option value="custom">Other (enter pip value)</option>
                    </select>
                </div>
                <div id="customPipValueContainer" style="display: none;">
                    <label for="customPipValue">Pip/Point Value per Standard Lot (€) :</label>
                    <input type="number" id="customPipValue" value="10" min="0.01" step="any">
                </div>

                <div>
                    <label for="stopLossInputMethod">Stop Loss Input Method :</label>
                    <select id="stopLossInputMethod">
                        <option value="pips_direct">Enter Pips Directly</option>
                        <option value="price_based">Calculate Pips from Price</option>
                    </select>
                </div>

                <div id="pipsDirectInputContainer">
                    <label for="stopLossPips">Stop Loss (in Pips) :</label>
                    <input type="number" id="stopLossPips" value="20" min="1" step="any">
                </div>

                <div id="priceBasedInputContainer" style="display: none;">
                    <div>
                        <label for="entryPrice">Entry Price :</label>
                        <input type="number" id="entryPrice" step="any">
                    </div>
                    <div>
                        <label for="stopLossPrice">Stop Loss Price :</label>
                        <input type="number" id="stopLossPrice" step="any">
                    </div>
                    <div>
                        <label for="tradeTypeForSL">Trade Type :</label>
                        <select id="tradeTypeForSL">
                            <option value="buy">Buy</option>
                            <option value="sell">Sell</option>
                        </select>
                    </div>
                </div>

                <button onclick="calculatePositionSize()" class="btn-primary">Calculate Position Size</button>
                <div id="resultBox" class="result-box">
                    <p>Recommended Position Size : <span id="lotSize"></span> lots</p>
                    <p>Pip/Point Value : <span id="pipValueDisplay"></span> €</p>
                    <p>Amount Risked : <span id="amountRisqued"></span> €</p>
                    <p id="calculatedPipsDisplay" style="display:none;">Calculated Pips: <span id="calculatedPips"></span></p>
                </div>
            </div>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const currencyPairSelect = document.getElementById('currencyPair');
            const customPipValueContainer = document.getElementById('customPipValueContainer');
            
            // Initial state based on default select value
            if (currencyPairSelect.value === 'custom') {
                customPipValueContainer.style.display = 'block';
            }

            currencyPairSelect.addEventListener('change', function() {
                if (this.value === 'custom') {
                    customPipValueContainer.style.display = 'block';
                } else {
                    customPipValueContainer.style.display = 'none';
                }
            });

            const stopLossInputMethodSelect = document.getElementById('stopLossInputMethod');
            const pipsDirectInputContainer = document.getElementById('pipsDirectInputContainer');
            const priceBasedInputContainer = document.getElementById('priceBasedInputContainer');

            // Function to update SL input visibility
            const updateSLInputVisibility = () => {
                if (stopLossInputMethodSelect.value === 'pips_direct') {
                    pipsDirectInputContainer.style.display = 'block';
                    priceBasedInputContainer.style.display = 'none';
                } else { // price_based
                    pipsDirectInputContainer.style.display = 'none';
                    priceBasedInputContainer.style.display = 'block';
                }
            };

            // Initial call to set correct visibility on load
            updateSLInputVisibility();

            // Add event listener for changes
            stopLossInputMethodSelect.addEventListener('change', updateSLInputVisibility);
        });

        // This function is crucial for calculating pips based on asset for price-based SL
        function getPipDecimalValue(currencyPair) {
            switch (currencyPair) {
                // Forex pairs where 1 pip = 0.0001 (or 0.01 for JPY)
                case 'EURUSD': case 'GBPUSD': case 'AUDUSD': case 'NZDUSD': case 'USDCAD': case 'USDCHF':
                    return 0.0001; // Standard 4-decimal pip
                case 'USDJPY': case 'EURJPY': case 'GBPJPY':
                    return 0.01; // JPY pairs have 2-decimal pip
                // Commodities/Indices where 1 point = 1 pip
                case 'XAUUSD': // Gold
                    return 0.1; // Gold is often quoted to 2 decimal places, with a 'pip' being 0.01
                case 'DAX40': case 'CAC40': case 'SP500': case 'NASDAQ100':
                    return 1; // For most indices, 1 point movement is considered 1 pip.
                case 'custom':
                    // For custom, we assume a standard Forex pip decimal value (0.0001) for price calculation
                    // unless the user implicitly knows the tick size of their custom asset.
                    // This is a default assumption for the 'price_based' calculation.
                    return 0.0001;
                default:
                    return 0.0001; // Default for most other pairs
            }
        }

        function calculatePositionSize() {
            const capital = parseFloat(document.getElementById('capital').value);
            const riskPercentage = parseFloat(document.getElementById('riskPercentage').value);
            const currencyPair = document.getElementById('currencyPair').value;
            const stopLossInputMethod = document.getElementById('stopLossInputMethod').value;
            
            let stopLossPips; // This will be calculated or taken directly
            let calcErrorMessage = null;

            if (stopLossInputMethod === 'pips_direct') {
                stopLossPips = parseFloat(document.getElementById('stopLossPips').value);
                if (isNaN(stopLossPips) || stopLossPips <= 0) {
                    calcErrorMessage = "Please enter a valid Stop Loss (in Pips) (> 0).";
                }
                document.getElementById('calculatedPipsDisplay').style.display = 'none'; // Hide if direct pips
            } else { // price_based
                const entryPrice = parseFloat(document.getElementById('entryPrice').value);
                const stopLossPrice = parseFloat(document.getElementById('stopLossPrice').value);
                const tradeTypeForSL = document.getElementById('tradeTypeForSL').value; // Unused in SL calculation, but kept for context if needed later
                const pipDecimalValue = getPipDecimalValue(currencyPair);

                if (isNaN(entryPrice) || isNaN(stopLossPrice) || entryPrice <= 0 || stopLossPrice <= 0) {
                    calcErrorMessage = "Please enter valid Entry Price and Stop Loss Price (> 0).";
                } else if (pipDecimalValue <= 0) {
                    calcErrorMessage = "Invalid Pip Decimal Value for the selected asset.";
                } else {
                    let priceDifference = Math.abs(entryPrice - stopLossPrice);
                    // The division by pipDecimalValue correctly converts the price difference into pips.
                    stopLossPips = priceDifference / pipDecimalValue;
                    document.getElementById('calculatedPips').textContent = stopLossPips.toFixed(2);
                    document.getElementById('calculatedPipsDisplay').style.display = 'block';
                }
            }

            const calcErrorMessageDiv = document.getElementById('calcErrorMessage');
            const resultBox = document.getElementById('resultBox');

            // Hide previous messages and results
            calcErrorMessageDiv.classList.remove('show');
            resultBox.classList.remove('show');

            // General validation
            if (isNaN(capital) || capital <= 0) {
                calcErrorMessage = calcErrorMessage || "Please enter a valid Account Capital (> 0).";
            }
            if (isNaN(riskPercentage) || riskPercentage <= 0 || riskPercentage > 100) {
                calcErrorMessage = calcErrorMessage || "Please enter a valid Risk Percentage (between 0.1 and 100).";
            }
            if (isNaN(stopLossPips) || stopLossPips <= 0) {
                   calcErrorMessage = calcErrorMessage || "Stop Loss Pips could not be determined. Please check your inputs.";
            }

            if (calcErrorMessage) {
                calcErrorMessageDiv.textContent = calcErrorMessage;
                calcErrorMessageDiv.classList.add('show');
                resultBox.style.display = 'none'; // Hide results if there's an error
                document.getElementById('calculatedPipsDisplay').style.display = 'none'; // Ensure this is hidden on error
                return;
            }

            let pipValuePerStandardLot;
            // This part uses the same currencyPair selection for the monetary value of a pip.
            switch (currencyPair) {
                case 'EURUSD': case 'GBPUSD': case 'AUDUSD': case 'NZDUSD': pipValuePerStandardLot = 10; break;
                case 'USDJPY': case 'EURJPY': case 'GBPJPY': pipValuePerStandardLot = 8.5; break; // This value is an approximation and can vary slightly by broker and specific JPY cross.
                case 'XAUUSD': pipValuePerStandardLot = 10; break; // For Gold (XAU/USD), 1 standard lot (100 oz) value per point/pip.
                case 'DAX40': case 'SP500': case 'NASDAQ100': case 'CAC40': pipValuePerStandardLot = 1; break; // For most indices, 1 point is often considered 1 unit of value.
                case 'custom':
                    pipValuePerStandardLot = parseFloat(document.getElementById('customPipValue').value);
                    if (isNaN(pipValuePerStandardLot) || pipValuePerStandardLot <= 0) {
                        calcErrorMessageDiv.textContent = "Please enter a valid custom Pip/Point Value per Standard Lot (> 0).";
                        calcErrorMessageDiv.classList.add('show');
                        resultBox.style.display = 'none';
                        document.getElementById('calculatedPipsDisplay').style.display = 'none';
                        return;
                    }
                    break;
                default: pipValuePerStandardLot = 10; // Default for other major Forex pairs
            }

            const amountToRisk = (capital * riskPercentage) / 100;
            const lotSize = amountToRisk / (stopLossPips * pipValuePerStandardLot);

            document.getElementById('lotSize').textContent = lotSize.toFixed(2);
            document.getElementById('pipValueDisplay').textContent = pipValuePerStandardLot.toFixed(2);
            document.getElementById('amountRisqued').textContent = amountToRisk.toFixed(2);
            resultBox.classList.add('show');
        }
    </script>
</body>
</html>